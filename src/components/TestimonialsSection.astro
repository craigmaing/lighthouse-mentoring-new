---
import { getCollection } from 'astro:content';
import TestimonialCarousel from './TestimonialCarousel.jsx';

const testimonials = await getCollection('testimonials');
// Prioritize international businesses and charities
const featuredTestimonials = testimonials
  .filter(t => t.data.featured)
  .sort((a, b) => a.data.priority - b.data.priority)
  .slice(0, 5);

// Get international business testimonials (show different ones if possible)
const featuredIds = featuredTestimonials.map(t => t.id);
const internationalTestimonials = testimonials
  .filter(t =>
    ['Brown-Forman', 'Edrington UK', 'Cornish Lithium', 'Healthy Hospo / Avallen Spirits'].includes(t.data.company)
  )
  .sort((a, b) => {
    // Prioritize testimonials not shown in featured
    const aFeatured = featuredIds.includes(a.id) ? 1 : 0;
    const bFeatured = featuredIds.includes(b.id) ? 1 : 0;
    return aFeatured - bFeatured;
  })
  .slice(0, 3);

const testimonialData = featuredTestimonials.map(t => t.data);
---

<!-- TESTIMONIALS CAROUSEL - C-Suite Endorsements -->
<section class="py-20 lg:py-32 px-6 lg:px-8 bg-white">
  <div class="container max-w-7xl mx-auto">
    <!-- Section Header -->
    <div class="max-w-4xl mx-auto mb-20 text-center">
      <p class="text-sm font-bold text-[#00D4AA] uppercase tracking-wider mb-4">Proven Results</p>
      <h2 class="text-5xl lg:text-6xl font-bold text-[#1A202C] mb-8 leading-tight">
        What Directors Say
      </h2>
      <p class="text-2xl text-[#4A5568] leading-relaxed">
        C-suite executives who've seen the transformation firsthand
      </p>
    </div>

    <!-- Premium Testimonial Carousel with Island Architecture -->
    <div class="testimonial-carousel-container">
      <TestimonialCarousel testimonials={testimonialData} client:visible />
    </div>

    <!-- Static Testimonial Cards (fallback for no-JS) -->
    <noscript>
      <div class="grid lg:grid-cols-3 gap-10">
        {featuredTestimonials.slice(0, 3).map((testimonial, index) => (
        <div class="group relative">
          <!-- Card Background with Premium Effect -->
          <div class="absolute inset-0 bg-gradient-to-br from-white to-[#F7FAFC] rounded-3xl shadow-xl group-hover:shadow-2xl transition-all duration-300"></div>
          <div class="relative bg-white/80 backdrop-blur-sm p-10 rounded-3xl border border-gray-100 h-full flex flex-col">

            <!-- Quote Mark - Premium Styling -->
            <div class="absolute -top-6 left-8">
              <div class="w-12 h-12 bg-gradient-to-br from-[#00D4AA] to-[#00C49C] rounded-2xl flex items-center justify-center shadow-lg">
                <svg class="w-6 h-6 text-white" fill="currentColor" viewBox="0 0 24 24">
                  <path d="M14.017 21v-7.391c0-5.704 3.731-9.57 8.983-10.609l.995 2.151c-2.432.917-3.995 3.638-3.995 5.849h4v10h-9.983zm-14.017 0v-7.391c0-5.704 3.748-9.57 9-10.609l.996 2.151c-2.433.917-3.996 3.638-3.996 5.849h3.983v10h-9.983z" />
                </svg>
              </div>
            </div>

            <!-- Testimonial Content -->
            <div class="mt-8 flex flex-col flex-grow">
              <p class="text-lg text-[#4A5568] leading-relaxed mb-8 flex-grow font-normal">
                "{testimonial.data.content.length > 280
                  ? testimonial.data.content.substring(0, 277) + '...'
                  : testimonial.data.content}"
              </p>

              <!-- Executive Author Info -->
              <div class="border-t border-gray-100 pt-6 mt-auto">
                <p class="text-xl font-bold text-[#1A202C] mb-1">{testimonial.data.name}</p>
                <p class="text-base text-[#4A5568] mb-2">{testimonial.data.role}</p>
                <p class="text-base text-[#0A4F63] font-semibold mb-4">{testimonial.data.company}</p>

                <!-- Success Tags -->
                <div class="flex flex-wrap gap-2">
                  {testimonial.data.tags.map(tag => (
                    <span class="text-xs bg-[#00D4AA]/10 text-[#0A4F63] font-medium px-3 py-1.5 rounded-full border border-[#00D4AA]/20">
                      {tag}
                    </span>
                  ))}
                </div>
              </div>
            </div>
          </div>
        </div>
      ))}
    </div>
    </noscript>

    <!-- Global Impact Stories - Dark Section -->
    <div class="mt-32 -mx-6 lg:-mx-8">
      <div class="dark-section py-20 lg:py-32 px-6 lg:px-8">
        <div class="container max-w-7xl mx-auto">
          <div class="text-center mb-16">
            <h3 class="text-4xl lg:text-5xl font-bold text-white mb-6">
              Global Impact
            </h3>
            <p class="text-xl text-white/90">
              From Fortune 500 companies to innovative UK leaders
            </p>
          </div>

          <div class="grid lg:grid-cols-3 gap-8">
            {internationalTestimonials.map((testimonial) => (
              <div class="bg-white/5 backdrop-blur-sm border border-white/10 p-8 rounded-2xl group hover:bg-white/10 transition-all">
                <!-- Company Badge -->
                <div class="mb-6">
                  <div class="inline-flex items-center gap-2 bg-[#00D4AA]/20 backdrop-blur-sm px-4 py-2 rounded-full border border-[#00D4AA]/30">
                    <div class="w-2 h-2 bg-[#00D4AA] rounded-full"></div>
                    <p class="text-sm font-bold text-white">{testimonial.data.company}</p>
                  </div>
                  <p class="text-xs text-white/60 mt-2 uppercase tracking-wide">Global Enterprise</p>
                </div>

                <p class="text-lg leading-relaxed mb-8 text-white/90">
                  "{testimonial.data.content.length > 180
                    ? testimonial.data.content.substring(0, 177) + '...'
                    : testimonial.data.content}"
                </p>

                <div class="border-t border-white/10 pt-6">
                  <p class="font-bold text-white text-lg">{testimonial.data.name}</p>
                  <p class="text-sm text-white/80">{testimonial.data.role}</p>
                </div>
              </div>
            ))}
          </div>
        </div>
      </div>
    </div>

    <!-- Social Proof Statistics -->
    <div class="mt-20 text-center bg-[#F7FAFC] rounded-3xl p-12 border border-gray-100">
      <div class="grid md:grid-cols-3 gap-8">
        <div>
          <div class="text-4xl font-light text-[#00D4AA] mb-2">20+</div>
          <p class="font-semibold text-[#1A202C] mb-1">LinkedIn Recommendations</p>
          <p class="text-sm text-[#4A5568]">Board directors & C-suite</p>
        </div>
        <div>
          <div class="text-4xl font-light text-[#00D4AA] mb-2">100+</div>
          <p class="font-semibold text-[#1A202C] mb-1">Organisations Transformed</p>
          <p class="text-sm text-[#4A5568]">Across 6 continents</p>
        </div>
        <div>
          <div class="text-4xl font-light text-[#00D4AA] mb-2">FTSE</div>
          <p class="font-semibold text-[#1A202C] mb-1">Global Brands</p>
          <p class="text-sm text-[#4A5568]">Including international leaders</p>
        </div>
      </div>
    </div>
  </div>
</section>